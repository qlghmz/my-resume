<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åŸºäº RK3588 RGA ç¡¬ä»¶åŠ é€Ÿçš„ä¸‰è·¯ç›¸æœºå¹¶å‘é¢„è§ˆæ–¹æ¡ˆè®¾è®¡ | JH.Dev</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-slate-50 text-slate-900">

    <nav class="bg-white border-b py-4">
        <div class="max-w-3xl mx-auto px-6 flex justify-between items-center">
            <a href="/blog/" class="text-sm font-bold text-blue-600">â† åšå®¢åˆ—è¡¨</a>
            <a href="/zh/" class="text-sm font-bold text-blue-600">ä¸»é¡µ</a>
        </div>
    </nav>

    <main class="max-w-3xl mx-auto px-6 py-12">
        <article class="space-y-8">
            <header>
                <span class="text-xs text-slate-400 font-mono">2026.02.07</span>
                <h1 class="text-3xl font-black mt-2 leading-tight">
                    åŸºäº RK3588 RGA ç¡¬ä»¶åŠ é€Ÿçš„ä¸‰è·¯ç›¸æœºå¹¶å‘é¢„è§ˆæ–¹æ¡ˆè®¾è®¡
                </h1>
                <p class="text-lg text-slate-500 mt-2">
                    Architecting High-Performance Multi-Camera Streaming with RGA Hardware Acceleration
                </p>
            </header>

            <div class="prose prose-slate max-w-none space-y-6 text-slate-600 leading-relaxed">
                <p>
                    åœ¨æœ€è¿‘çš„åµŒå…¥å¼ Linux é¡¹ç›®å¼€å‘ä¸­ï¼Œæˆ‘è´Ÿè´£æ ¸å¿ƒçš„è§†è§‰é‡‡é›†æ¨¡å—ï¼Œç›®æ ‡æ˜¯å®ç°ä¸‰è·¯é«˜åˆ†è¾¨ç‡ç›¸æœºï¼ˆåŒ…æ‹¬åŒè½´ã€USBåŠæ— çº¿å›¾ä¼ ï¼‰çš„åŒæ—¶å¼€å¯ä¸å®æ—¶é¢„è§ˆã€‚
                    é¢å¯¹å¦‚æ­¤é«˜ååé‡çš„è§†é¢‘æµæ•°æ®ï¼Œæˆ‘åœ¨æ¶æ„è®¾è®¡åˆæœŸå°±æ„è¯†åˆ°ï¼šå¦‚æœæ²¿ç”¨ä¼ ç»Ÿçš„ CPU è½¯è§£ï¼ˆå¦‚ cv::cvtColorï¼‰è¿›è¡Œ YUV åˆ° RGB çš„æ ¼å¼è½¬æ¢ï¼Œå¿…ç„¶ä¼šæŠ¢å å®è´µçš„ CPU ç®—åŠ›ï¼Œå¯¼è‡´ UI äº¤äº’å¡é¡¿ã€‚
                </p>

                <h2 class="text-xl font-bold text-slate-800 mt-8">ğŸš€ æ¶æ„é€‰å‹ä¸å®ç°æ–¹æ¡ˆ</h2>
                <p>
                    åŸºäºå¯¹ Rockchip ç¡¬ä»¶æ¶æ„çš„ç†è§£ï¼Œæˆ‘ç›´æ¥é‡‡ç”¨äº† SoC å†…ç½®çš„ RGA (2D Raster Graphic Acceleration) å¼•æ“ä½œä¸ºæ ¸å¿ƒå¤„ç†å•å…ƒã€‚
                    æˆ‘è®¾è®¡äº†ä¸€å¥—åŸºäº DMA (Direct Memory Access) çš„é›¶æ‹·è´å–å›¾æœºåˆ¶ã€‚é€šè¿‡ç›´æ¥æ“ä½œç‰©ç†è¿ç»­å†…å­˜ï¼Œå°†å¤šè·¯ç›¸æœºçš„åŸå§‹ YUV æ•°æ®ç›´æ¥â€œå–‚â€ç»™ RGA ç¡¬ä»¶è¿›è¡Œæ ¼å¼è½¬æ¢ä¸ç¼©æ”¾ï¼Œç»•è¿‡ CPU çš„ Cache åˆ·æ–°ï¼Œæœ€å¤§åŒ–åˆ©ç”¨äº†æ€»çº¿å¸¦å®½ã€‚
                </p>

                <h2 class="text-xl font-bold text-slate-800 mt-8">ğŸ’¡ æ”»å…‹çš„æŠ€æœ¯éš¾ç‚¹</h2>
                <p>
                    è™½ç„¶ RGA æ•ˆç‡æé«˜ï¼Œä½†åœ¨è½åœ°æ—¶æˆ‘è§£å†³äº†ä»¥ä¸‹åº•å±‚æŒ‘æˆ˜ï¼š
                </p>
                <ul class="list-disc pl-6 space-y-2">
                    <li><strong>å†…å­˜ç®¡ç†çš„ä¸¥è‹›è¦æ±‚ï¼š</strong>RGA å¯¹å†…å­˜åœ°å€æœ‰ä¸¥æ ¼çš„å¯¹é½çº¦æŸã€‚æˆ‘é€šè¿‡ posix_memalign å®ç°äº† 4K é¡µå¯¹é½çš„å†…å­˜æ± ç®¡ç†ï¼Œç¡®ä¿ç¡¬ä»¶ DMA ä¼ è¾“çš„ç¨³å®šæ€§ï¼Œè§£å†³äº†æ½œåœ¨çš„ç”»é¢æ’•è£‚ä¸æ®µé”™è¯¯é—®é¢˜ã€‚</li>
                    <li><strong>å¼‚æ„æºçš„ç»Ÿä¸€æŠ½è±¡ï¼š</strong>ç”±äºä¸‰è·¯ç›¸æœºçš„æ¥å£ä¸åŒï¼ˆMIPI/USBï¼‰ï¼Œå…¶è¾“å‡ºæ ¼å¼ï¼ˆUYVY/YUYVï¼‰ä¹Ÿä¸å°½ç›¸åŒã€‚æˆ‘å°è£…äº†ç»Ÿä¸€çš„ Buffer å¤„ç†å±‚ï¼Œæ ¹æ® V4L2 æ•è·çš„å…ƒæ•°æ®åŠ¨æ€é…ç½® RGA é€šé“ï¼Œå®ç°äº†å¯¹ä¸åŒç¡¬ä»¶æºçš„é€æ˜å…¼å®¹ã€‚</li>
                </ul>

                <h2 class="text-xl font-bold text-slate-800 mt-8">æœ€ç»ˆæˆæœ</h2>
                <p>
                    è¯¥æ–¹æ¡ˆæˆåŠŸå®ç°äº†ä¸‰è·¯ç›¸æœºçš„å¹¶å‘æµç•…é¢„è§ˆã€‚åœ¨æ»¡è´Ÿè½½è¿è¡Œä¸‹ï¼ŒCPU ä¾ç„¶ä¿æŒåœ¨æä½çš„å ç”¨ç‡ï¼Œä¸ºåç»­çš„ä¸šåŠ¡é€»è¾‘å’Œå¤æ‚ UI æ¸²æŸ“ç•™è¶³äº†ç®—åŠ›ç©ºé—´ã€‚è¿™å†æ¬¡è¯æ˜äº†åœ¨åµŒå…¥å¼å¼€å‘ä¸­ï¼Œâ€œè½¯ç¡¬ç»“åˆâ€çš„è®¾è®¡æ€ç»´è‡³å…³é‡è¦ã€‚
                </p>

                <div class="flex flex-wrap gap-2 pt-4">
                    <span class="text-xs px-2 py-1 bg-slate-100 rounded text-slate-600">#åµŒå…¥å¼å¼€å‘</span>
                    <span class="text-xs px-2 py-1 bg-slate-100 rounded text-slate-600">#Linux</span>
                    <span class="text-xs px-2 py-1 bg-slate-100 rounded text-slate-600">#Rockchip</span>
                    <span class="text-xs px-2 py-1 bg-slate-100 rounded text-slate-600">#RGA</span>
                    <span class="text-xs px-2 py-1 bg-slate-100 rounded text-slate-600">#é«˜æ€§èƒ½è®¡ç®—</span>
                    <span class="text-xs px-2 py-1 bg-slate-100 rounded text-slate-600">#C++</span>
                    <span class="text-xs px-2 py-1 bg-slate-100 rounded text-slate-600">#Qt</span>
                    <span class="text-xs px-2 py-1 bg-slate-100 rounded text-slate-600">#æ¶æ„è®¾è®¡</span>
                </div>
            </div>

            <hr class="border-slate-200 my-12">

            <div class="space-y-6 text-slate-600 leading-relaxed">
                <h2 class="text-2xl font-bold text-slate-800">English</h2>
                <p>
                    In my recent Embedded Linux project (RK3588), I was tasked with a critical requirement: simultaneously capturing and previewing three distinct high-resolution camera streams (Coaxial, USB, and Wireless transmission).
                    During the initial architectural design phase, I recognized that a traditional CPU-based approach (like software color conversion) would be a bottleneck for such high-throughput video data, inevitably choking the UI thread.
                </p>
                <h3 class="text-lg font-bold text-slate-800">ğŸš€ The Architectural Decision</h3>
                <p>
                    Leveraging my knowledge of the Rockchip SoC capabilities, I proactively designed the pipeline around the RGA (2D Raster Graphic Acceleration) engine from day one.
                    Instead of relying on CPU cycles, I implemented a DMA (Direct Memory Access) based mechanism. This approach feeds raw YUV data from the V4L2 buffers directly into the RGA hardware for format conversion (YUV to RGB) and scaling. This bypasses unnecessary CPU cache operations and maximizes memory bandwidth efficiency.
                </p>
                <h3 class="text-lg font-bold text-slate-800">ğŸ’¡ Technical Challenges Solved</h3>
                <p>
                    While RGA is powerful, enabling it required solving specific low-level constraints:
                </p>
                <ul class="list-disc pl-6 space-y-2">
                    <li><strong>Strict Memory Alignment:</strong> RGA hardware demands precise memory alignment. I implemented a memory pool using posix_memalign to ensure 4K page-aligned buffers, preventing DMA transmission errors and ensuring stable video output.</li>
                    <li><strong>Handling Heterogeneous Sources:</strong> The three cameras utilized different interfaces and output different raw formats (UYVY vs. YUYV). I engineered a unified buffer abstraction layer that dynamically configures the RGA channels based on the source metadata, ensuring seamless compatibility across all streams.</li>
                </ul>
                <h3 class="text-lg font-bold text-slate-800">The Result</h3>
                <p>
                    The system now supports concurrent, smooth previewing of all three cameras. Even under full load, CPU usage remains negligible for video processing, leaving ample headroom for complex business logic and UI rendering. This confirms that in embedded systems, designing with hardware acceleration in mind is key to unlocking maximum performance.
                </p>
                <div class="flex flex-wrap gap-2 pt-4">
                    <span class="text-xs px-2 py-1 bg-slate-100 rounded text-slate-600">#EmbeddedSystems</span>
                    <span class="text-xs px-2 py-1 bg-slate-100 rounded text-slate-600">#Linux</span>
                    <span class="text-xs px-2 py-1 bg-slate-100 rounded text-slate-600">#Rockchip</span>
                    <span class="text-xs px-2 py-1 bg-slate-100 rounded text-slate-600">#RGA</span>
                    <span class="text-xs px-2 py-1 bg-slate-100 rounded text-slate-600">#HighPerformance</span>
                    <span class="text-xs px-2 py-1 bg-slate-100 rounded text-slate-600">#Cpp</span>
                    <span class="text-xs px-2 py-1 bg-slate-100 rounded text-slate-600">#Qt</span>
                    <span class="text-xs px-2 py-1 bg-slate-100 rounded text-slate-600">#SystemArchitecture</span>
                </div>
            </div>
        </article>

        <div class="mt-12 pt-8 border-t border-slate-200">
            <a href="/blog/" class="text-blue-600 font-medium hover:underline">â† è¿”å›åšå®¢åˆ—è¡¨</a>
        </div>
    </main>

    <footer class="py-12 text-center text-slate-400 text-xs italic">
        "Stay Hungry, Stay Foolish."
    </footer>
</body>
</html>
